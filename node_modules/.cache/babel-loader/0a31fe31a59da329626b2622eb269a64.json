{"remainingRequest":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/babel-loader/lib/index.js!/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/eslint-loader/index.js??ref--13-0!/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/router/middlewares.js","dependencies":[{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/router/middlewares.js","mtime":1592322774000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvamFja3Nvbi9Eb2N1bWVudHMvV29yay9ERU1PL1Z1ZUpTQnV0dGVyQ01TL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICRzdG9yZSBmcm9tICcuLi9zdG9yZSc7CmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnOwovKioKICogQ3VycmVudCB1c2VyIHN0YXRlIGluaXRpYWxpemF0aW9uCiAqIEBXQVJOIE11c3QgYmUgYWx3YXlzIGZpcnN0IGluIG1pZGRsZXdhcmUgY2hhaW4KICovCgpleHBvcnQgZnVuY3Rpb24gaW5pdEN1cnJlbnRVc2VyU3RhdGVNaWRkbGV3YXJlKF94LCBfeDIsIF94MykgewogIHJldHVybiBfaW5pdEN1cnJlbnRVc2VyU3RhdGVNaWRkbGV3YXJlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KLyoqCiAqIENoZWNrIGFjY2VzcyBwZXJtaXNzaW9uIHRvIGF1dGggcm91dGVzCiAqLwoKZnVuY3Rpb24gX2luaXRDdXJyZW50VXNlclN0YXRlTWlkZGxld2FyZSgpIHsKICBfaW5pdEN1cnJlbnRVc2VyU3RhdGVNaWRkbGV3YXJlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgY3VycmVudFVzZXJJZDsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY3VycmVudFVzZXJJZCA9ICRzdG9yZS5zdGF0ZS51c2VyLmN1cnJlbnRVc2VyLmlkOwoKICAgICAgICAgICAgaWYgKCEoQXV0aFNlcnZpY2UuaGFzUmVmcmVzaFRva2VuKCkgJiYgIWN1cnJlbnRVc2VySWQpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5kZWJvdW5jZVJlZnJlc2hUb2tlbnMoKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICByZXR1cm4gJHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldEN1cnJlbnQnKTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTA7CiAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMik7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0LnQwKTsKCiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIG5leHQoKTsKCiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMiwgMTBdXSk7CiAgfSkpOwogIHJldHVybiBfaW5pdEN1cnJlbnRVc2VyU3RhdGVNaWRkbGV3YXJlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBjaGVja0FjY2Vzc01pZGRsZXdhcmUodG8sIGZyb20sIG5leHQpIHsKICB2YXIgY3VycmVudFVzZXJJZCA9ICRzdG9yZS5zdGF0ZS51c2VyLmN1cnJlbnRVc2VyLmlkOwogIHZhciBpc0F1dGhSb3V0ZSA9IHRvLm1hdGNoZWQuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0ubWV0YS5pc0F1dGg7CiAgfSk7CiAgaWYgKGlzQXV0aFJvdXRlICYmIGN1cnJlbnRVc2VySWQpIHJldHVybiBuZXh0KCk7CiAgaWYgKGlzQXV0aFJvdXRlKSByZXR1cm4gbmV4dCh7CiAgICBuYW1lOiAnbG9naW4nCiAgfSk7CiAgbmV4dCgpOwp9CmV4cG9ydCBmdW5jdGlvbiBzZXRQYWdlVGl0bGVNaWRkbGV3YXJlKHRvLCBmcm9tLCBuZXh0KSB7CiAgdmFyIHBhZ2VUaXRsZSA9IHRvLm1hdGNoZWQuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0ubWV0YS50aXRsZTsKICB9KTsKICBpZiAocGFnZVRpdGxlKSB3aW5kb3cuZG9jdW1lbnQudGl0bGUgPSBwYWdlVGl0bGUubWV0YS50aXRsZTsKICBuZXh0KCk7Cn0="},{"version":3,"sources":["/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/router/middlewares.js"],"names":["$store","AuthService","initCurrentUserStateMiddleware","to","from","next","currentUserId","state","user","currentUser","id","hasRefreshToken","debounceRefreshTokens","dispatch","console","log","checkAccessMiddleware","isAuthRoute","matched","some","item","meta","isAuth","name","setPageTitleMiddleware","pageTitle","find","title","window","document"],"mappings":";;;;AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,SAASC,WAAT,QAA4B,yBAA5B;AAEA;;;;;AAIA,gBAAsBC,8BAAtB;AAAA;AAAA;AAgBA;;;;;4FAhBO,iBAA+CC,EAA/C,EAAmDC,IAAnD,EAAyDC,IAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,aADD,GACiBN,MAAM,CAACO,KAAP,CAAaC,IAAb,CAAkBC,WAAlB,CAA8BC,EAD/C;;AAAA,kBAGDT,WAAW,CAACU,eAAZ,MAAiC,CAACL,aAHjC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAKKL,WAAW,CAACW,qBAAZ,EALL;;AAAA;AAAA;AAAA,mBAMKZ,MAAM,CAACa,QAAP,CAAgB,iBAAhB,CANL;;AAAA;AAODR,YAAAA,IAAI;AAPH;AAAA;;AAAA;AAAA;AAAA;AASDS,YAAAA,OAAO,CAACC,GAAR;;AATC;AAAA;AAAA;;AAAA;AAYHV,YAAAA,IAAI;;AAZD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAmBP,OAAO,SAASW,qBAAT,CAAgCb,EAAhC,EAAoCC,IAApC,EAA0CC,IAA1C,EAAgD;AACrD,MAAMC,aAAa,GAAGN,MAAM,CAACO,KAAP,CAAaC,IAAb,CAAkBC,WAAlB,CAA8BC,EAApD;AACA,MAAMO,WAAW,GAAGd,EAAE,CAACe,OAAH,CAAWC,IAAX,CAAgB,UAAAC,IAAI;AAAA,WAAIA,IAAI,CAACC,IAAL,CAAUC,MAAd;AAAA,GAApB,CAApB;AAEA,MAAIL,WAAW,IAAIX,aAAnB,EAAkC,OAAOD,IAAI,EAAX;AAClC,MAAIY,WAAJ,EAAiB,OAAOZ,IAAI,CAAC;AAAEkB,IAAAA,IAAI,EAAE;AAAR,GAAD,CAAX;AACjBlB,EAAAA,IAAI;AACL;AAED,OAAO,SAASmB,sBAAT,CAAiCrB,EAAjC,EAAqCC,IAArC,EAA2CC,IAA3C,EAAiD;AACtD,MAAMoB,SAAS,GAAGtB,EAAE,CAACe,OAAH,CAAWQ,IAAX,CAAgB,UAAAN,IAAI;AAAA,WAAIA,IAAI,CAACC,IAAL,CAAUM,KAAd;AAAA,GAApB,CAAlB;AAEA,MAAIF,SAAJ,EAAeG,MAAM,CAACC,QAAP,CAAgBF,KAAhB,GAAwBF,SAAS,CAACJ,IAAV,CAAeM,KAAvC;AACftB,EAAAA,IAAI;AACL","sourcesContent":["import $store from '../store'\nimport { AuthService } from '@/services/auth.service'\n\n/**\n * Current user state initialization\n * @WARN Must be always first in middleware chain\n */\nexport async function initCurrentUserStateMiddleware (to, from, next) {\n  const currentUserId = $store.state.user.currentUser.id\n\n  if (AuthService.hasRefreshToken() && !currentUserId) {\n    try {\n      await AuthService.debounceRefreshTokens()\n      await $store.dispatch('user/getCurrent')\n      next()\n    } catch (e) {\n      console.log(e)\n    }\n  } else {\n    next()\n  }\n}\n\n/**\n * Check access permission to auth routes\n */\nexport function checkAccessMiddleware (to, from, next) {\n  const currentUserId = $store.state.user.currentUser.id\n  const isAuthRoute = to.matched.some(item => item.meta.isAuth)\n\n  if (isAuthRoute && currentUserId) return next()\n  if (isAuthRoute) return next({ name: 'login' })\n  next()\n}\n\nexport function setPageTitleMiddleware (to, from, next) {\n  const pageTitle = to.matched.find(item => item.meta.title)\n\n  if (pageTitle) window.document.title = pageTitle.meta.title\n  next()\n}\n"]}]}