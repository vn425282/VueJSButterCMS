{"remainingRequest":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/babel-loader/lib/index.js!/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/eslint-loader/index.js??ref--13-0!/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/services/http.init.js","dependencies":[{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/services/http.init.js","mtime":1592322774000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL2phY2tzb24vRG9jdW1lbnRzL1dvcmsvREVNTy9WdWVKU0J1dHRlckNNUy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9Vc2Vycy9qYWNrc29uL0RvY3VtZW50cy9Xb3JrL0RFTU8vVnVlSlNCdXR0ZXJDTVMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKCi8qKgogKiBIVFRQIHJlcXVlc3QgbGF5ZXIKICogaWYgYXV0aCBpcyByZXF1aXJlZCByZXR1cm4gcGF0Y2hlZCBheGlvcyBpbnN0YW5jZSh3aXRoIGFjY2VzcyB0b2tlbiBpbiBoZWFkZXJzKQogKiBlbHNlIHJldHVybiBjbGVhciBheGlvcyBpbnN0YW5jZQogKi8KaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguc2VydmljZSc7CmltcG9ydCB7IEFQSV9VUkwgfSBmcm9tICcuLi8uZW52JzsKZXhwb3J0IHZhciBIdHRwID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBIdHRwKHN0YXR1cykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEh0dHApOwoKICAgIHRoaXMuaXNBdXRoID0gc3RhdHVzICYmIHN0YXR1cy5hdXRoID8gc3RhdHVzLmF1dGggOiBmYWxzZTsKICAgIHRoaXMuaW5zdGFuY2UgPSBheGlvcy5jcmVhdGUoewogICAgICBiYXNlVVJMOiBBUElfVVJMCiAgICB9KTsKICAgIHJldHVybiB0aGlzLmluaXQoKTsKICB9CgogIF9jcmVhdGVDbGFzcyhIdHRwLCBbewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgaWYgKHRoaXMuaXNBdXRoKSB7CiAgICAgICAgdGhpcy5pbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5hdXRob3JpemF0aW9uID0gQXV0aFNlcnZpY2UuZ2V0QmVhcmVyKCk7IC8vIGlmIGFjY2VzcyB0b2tlbiBleHBpcmVkIGFuZCByZWZyZXNoVG9rZW4gaXMgZXhpc3QgPj4gZ28gdG8gQVBJIGFuZCBnZXQgbmV3IGFjY2VzcyB0b2tlbgoKICAgICAgICAgIGlmIChBdXRoU2VydmljZS5pc0FjY2Vzc1Rva2VuRXhwaXJlZCgpICYmIEF1dGhTZXJ2aWNlLmhhc1JlZnJlc2hUb2tlbigpKSB7CiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5kZWJvdW5jZVJlZnJlc2hUb2tlbnMoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNldEJlYXJlcihyZXNwb25zZS5kYXRhLmFjY2Vzc1Rva2VuKTsKICAgICAgICAgICAgICByZXF1ZXN0LmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9IEF1dGhTZXJ2aWNlLmdldEJlYXJlcigpOwogICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSHR0cDsKfSgpOw=="},{"version":3,"sources":["/Users/jackson/Documents/Work/DEMO/VueJSButterCMS/src/services/http.init.js"],"names":["axios","AuthService","API_URL","Http","status","isAuth","auth","instance","create","baseURL","init","interceptors","request","use","headers","authorization","getBearer","isAccessTokenExpired","hasRefreshToken","debounceRefreshTokens","then","response","setBearer","data","accessToken","error","Promise","reject"],"mappings":";;;;AAAA;;;;;AAMA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,SAASC,WAAT,QAA4B,yBAA5B;AACA,SAASC,OAAT,QAAwB,SAAxB;AAEA,WAAaC,IAAb;AACE,gBAAaC,MAAb,EAAqB;AAAA;;AACnB,SAAKC,MAAL,GAAcD,MAAM,IAAIA,MAAM,CAACE,IAAjB,GAAwBF,MAAM,CAACE,IAA/B,GAAsC,KAApD;AACA,SAAKC,QAAL,GAAgBP,KAAK,CAACQ,MAAN,CAAa;AAC3BC,MAAAA,OAAO,EAAEP;AADkB,KAAb,CAAhB;AAIA,WAAO,KAAKQ,IAAL,EAAP;AACD;;AARH;AAAA;AAAA,2BAUU;AACN,UAAI,KAAKL,MAAT,EAAiB;AACf,aAAKE,QAAL,CAAcI,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CAAuC,UAAAD,OAAO,EAAI;AAChDA,UAAAA,OAAO,CAACE,OAAR,CAAgBC,aAAhB,GAAgCd,WAAW,CAACe,SAAZ,EAAhC,CADgD,CAEhD;;AACA,cAAIf,WAAW,CAACgB,oBAAZ,MAAsChB,WAAW,CAACiB,eAAZ,EAA1C,EAAyE;AACvE,mBAAOjB,WAAW,CAACkB,qBAAZ,GACJC,IADI,CACC,UAAAC,QAAQ,EAAI;AAChBpB,cAAAA,WAAW,CAACqB,SAAZ,CAAsBD,QAAQ,CAACE,IAAT,CAAcC,WAApC;AACAZ,cAAAA,OAAO,CAACE,OAAR,CAAgBC,aAAhB,GAAgCd,WAAW,CAACe,SAAZ,EAAhC;AACA,qBAAOJ,OAAP;AACD,aALI,WAKI,UAAAa,KAAK;AAAA,qBAAIC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAJ;AAAA,aALT,CAAP;AAMD,WAPD,MAOO;AACL,mBAAOb,OAAP;AACD;AACF,SAbD,EAaG,UAAAa,KAAK,EAAI;AACV,iBAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,SAfD;AAgBD;;AAED,aAAO,KAAKlB,QAAZ;AACD;AA/BH;;AAAA;AAAA","sourcesContent":["/**\n * HTTP request layer\n * if auth is required return patched axios instance(with access token in headers)\n * else return clear axios instance\n */\n\nimport axios from 'axios'\n\nimport { AuthService } from '@/services/auth.service'\nimport { API_URL } from '../.env'\n\nexport class Http {\n  constructor (status) {\n    this.isAuth = status && status.auth ? status.auth : false\n    this.instance = axios.create({\n      baseURL: API_URL\n    })\n\n    return this.init()\n  }\n\n  init () {\n    if (this.isAuth) {\n      this.instance.interceptors.request.use(request => {\n        request.headers.authorization = AuthService.getBearer()\n        // if access token expired and refreshToken is exist >> go to API and get new access token\n        if (AuthService.isAccessTokenExpired() && AuthService.hasRefreshToken()) {\n          return AuthService.debounceRefreshTokens()\n            .then(response => {\n              AuthService.setBearer(response.data.accessToken)\n              request.headers.authorization = AuthService.getBearer()\n              return request\n            }).catch(error => Promise.reject(error))\n        } else {\n          return request\n        }\n      }, error => {\n        return Promise.reject(error)\n      })\n    }\n\n    return this.instance\n  }\n}\n"]}]}